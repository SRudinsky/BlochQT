#include <complex>
typedef std::complex<double> dcomp;

/* Constants */
const double h = 6.621204e-34; //Plank's constant in J.s or kg*m^2/s
const double pi = acos(-1.); const dcomp ri = sqrt((dcomp)-1);
const double hbar = h/(2*pi); 
const double rest_mass = 9.10938356e-31; //Mass of an electron in kg
const double c = 299792458; //Speed of light in m/s
const double charge = -1.60217662e-19; //charge in coulombs
const double E = rest_mass*c*c;
const double toJ = 6.24150636309e18; //1 J = toJ eV

/*Parameters for elastic atomic scattering factors from Kirkland*/
const double scatF_A[41][3] = {{0,0,0},{4.20298324e-003,6.27762505e-002,3.00907347e-002},{1.87543704e-005,4.10595800e-004,1.96300059e-001},{7.45843816e-002,7.15382250e-002,1.45315229e-001},{6.11642897e-002,1.25755034e-001,2.00831548e-001},{1.25716066e-001,1.73314452e-001,1.84774811e-001},{2.12080767e-001,1.99811865e-001,1.68254385e-001},{5.33015554e-001,5.29008883e-002,9.24159648e-002},{3.39969204e-001,3.07570172e-001,1.30369072e-001},{2.30560593e-001,5.26889648e-001,1.24346755e-001},{4.08371771e-001,4.54418858e-001,1.44564923e-001},{1.36471662e-001,7.70677865e-001,1.56862014e-001},{3.04384121e-001,7.56270563e-001,1.01164809e-001},{7.77419424e-001,5.78312036e-002,4.26386499e-001},{1.06543892e+000,1.20143691e-001,1.80915263e-001},{1.05284447e+000,2.99440284e-001,1.17460748e-001},{1.01646916e+000,4.41766748e-001,1.21503863e-001},{9.44221116e-001,4.37322049e-001,2.54547926e-001},{1.06983288e+000,4.24631786e-001,2.43897949e-001},{6.92717865e-001,9.65161085e-001,1.48466588e-001},{3.66902871e-001,8.66378999e-001,6.67203300e-001},{3.78871777e-001,9.00022505e-001,7.15288914e-001},{3.62383267e-001,9.84232966e-001,7.41715642e-001},{3.52961378e-001,7.46791014e-001,1.08364068e+000},{1.34348379e+000,5.07040328e-001,4.26358955e-001},{3.26697613e-001,7.17297000e-001,1.33212464e+000},{3.13454847e-001,6.89290016e-001,1.47141531e+000},{3.15878278e-001,1.60139005e+000,6.56394338e-001},{1.72254630e+000,3.29543044e-001,6.23007200e-001},{3.58774531e-001,1.76181348e+000,6.36905053e-001},{5.70893973e-001,1.98908856e+000,3.06060585e-001},{6.25528464e-001,2.05302901e+000,2.89608120e-001},{5.90952690e-001,5.39980660e-001,2.00626188e+000},{7.77875218e-001,5.93848150e-001,1.95918751e+000},{9.58390681e-001,6.03851342e-001,1.90828931e+000},{1.14136170e+000,5.18118737e-001,1.85731975e+000},{3.24386970e-001,1.31732163e+000,1.79912614e+000},{2.90445351e-001,2.44201329e+000,7.69435449e-001},{1.37373086e-002,1.97548672e+000,1.59261029e+000},{6.75302747e-001,4.70286720e-001,2.63497677e+000},{2.64365505e+000,5.54225147e-001,7.61376625e-001}};
const double scatF_B[41][3] = {{0,0,0},{2.25350888e-001,2.25366950e-001,2.25331756e-001},{2.12427997e-001,3.32212279e-001,5.17325152e-001},{8.81151424e-001,4.59142904e-002,8.81301714e-001},{9.90182132e-002,9.90272412e-002,1.87392509e+000},{1.48258830e-001,1.48257216e-001,3.34227311e+000},{2.08605417e-001,2.08610186e-001,5.57870773e+000},{2.90952515e-001,1.03547896e+001,1.03540028e+001},{3.81570280e-001,3.81571436e-001,1.91919745e+001},{4.80754213e-001,4.80763895e-001,3.95306720e+001},{5.88228627e-001,5.88288655e-001,1.21246013e+002},{4.99965301e-002,8.81899664e-001,1.61768579e+001},{8.42014377e-002,1.64065598e+000,2.97142975e+001},{2.71058227e+000,7.17532098e+001,9.13331555e-002},{1.04118455e+000,6.87113368e+001,8.87533926e-002},{1.31962590e+000,1.28460520e-001,1.02190163e+002},{1.69181965e+000,1.74180288e-001,1.67011091e+002},{2.40052374e-001,9.30510439e+000,9.30486346e+000},{2.87791022e-001,1.24156957e+001,1.24158868e+001},{7.10849990e+000,3.57532901e-001,3.93763275e-002},{6.14274129e-002,5.70881727e-001,7.82965639e+000},{6.98910162e-002,5.21061541e-001,7.87707920e+000},{7.54707114e-002,4.97757309e-001,8.17659391e+000},{8.19204103e-002,8.81189511e+000,5.10646075e-001},{1.25814353e+000,1.15042811e+001,8.53660389e-002},{8.88813083e-002,1.11300198e+001,5.82141104e-001},{8.99325756e-002,1.30366038e+001,6.33345291e-001},{9.46683246e-002,6.99436449e-001,1.56954403e+001},{7.76606908e-001,1.02262360e-001,1.94156207e+001},{1.06153463e-001,1.01640995e+000,1.53659093e+001},{1.26534614e-001,2.17781965e+000,3.78619003e+001},{1.10005650e-001,2.41095786e+000,4.78685736e+001},{1.18375976e-001,7.18937433e+001,1.39304889e+000},{1.50733157e-001,1.42882209e+002,1.74750339e+000},{1.83775557e-001,1.96819224e+002,2.15082053e+000},{2.18708710e-001,1.93916682e+002,2.65755396e+000},{6.31317973e+001,2.54706036e-001,3.23668394e+000},{3.68420227e-002,1.16013332e+000,1.69591472e+001},{1.87469061e-002,6.36079230e+000,2.21992482e-001},{6.54331847e-002,1.06108709e+002,2.06643540e+000},{2.20202699e+000,1.78260107e+002,7.67218745e-002}};
const double scatF_C[41][3] = {{0,0,0},{6.77756695e-002,3.56609237e-003,2.76135815e-002},{8.36015738e-003,2.95102022e-002,4.65928982e-007},{1.12125769e+000,2.51736525e-003,3.58434971e-001},{7.87242876e-001,1.58847850e-003,2.73962031e-001},{1.95250221e-001,5.29642075e-001,1.08230500e-003},{1.42048360e-001,3.63830672e-001,8.35012044e-004},{2.61799101e-001,8.80262108e-004,1.10166555e-001},{8.83326058e-002,1.96586700e-001,9.96220028e-004},{1.24616894e-003,7.20452555e-002,1.53075777e-001},{5.91531395e-002,1.24003718e-001,1.64986037e-003},{9.96821513e-001,3.80304670e-002,1.27685089e-001},{3.45203403e-002,9.71751327e-001,1.20593012e-001},{1.13407220e-001,7.90114035e-001,3.23293496e-002},{1.12065620e+000,3.05452816e-002,1.59963502e+000},{9.60643452e-001,2.63555748e-002,1.38059330e+000},{8.27966670e-001,2.33022533e-002,1.18302846e+000},{5.47763323e-002,8.00087488e-001,1.07488641e-002},{4.79446296e-002,7.64958952e-001,8.23128431e-003},{2.64645027e-002,1.80883768e+000,5.43900018e-001},{4.87743636e-001,1.82406314e+000,2.20248453e-002},{1.88640973e-002,4.07945949e-001,1.61786540e+000},{3.62555269e-001,1.49159390e+000,1.61659509e-002},{1.39013610e+000,3.31273356e-001,1.40422612e-002},{1.17241826e-002,5.11966516e-001,3.38285828e-001},{2.80801702e-001,1.15499241e+000,1.11984488e-002},{1.03298688e+000,2.58280285e-001,1.03460690e-002},{9.36746624e-001,9.77562646e-003,2.38378578e-001},{9.43496513e-003,8.54063515e-001,2.21073515e-001},{7.44930667e-003,1.89002347e-001,2.29619589e-001},{2.35600223e-001,3.97061102e-001,6.85657228e-003},{2.07910594e-001,3.45079617e-001,6.55634298e-003},{7.49705041e-001,1.83581347e-001,9.52190743e-003},{1.79880226e-001,8.63267222e-001,9.59053427e-003},{1.73885956e-001,9.35265145e-001,8.62254658e-003},{1.68217399e-001,9.75705606e-001,7.24187871e-003},{4.29961425e-003,1.00429433e+000,1.62188197e-001},{1.58687000e+000,2.81617593e-003,1.28663830e-001},{1.73263882e-001,4.66280378e+000,1.61265063e-003},{1.09621746e-001,9.60348773e-001,5.28921555e-003},{6.02946891e-003,9.91630530e-002,9.56782020e-001}};
const double scatF_D[41][3] = {{0,0,0},{4.38854001e+000,4.03884823e-001,1.44490166e+000},{3.66668239e-001,1.37171827e+000,3.75768025e+004},{1.88483665e+001,1.59189995e-001,6.12371000e+000},{9.32794929e+000,8.91900236e-002,3.20687658e+000},{1.97339463e+000,5.70035553e+000,5.64857237e-002},{1.33311887e+000,3.80800263e+000,4.03982620e-002},{2.76252723e+000,3.47681236e-002,9.93421736e-001},{7.60635525e-001,2.07401094e+000,3.03266869e-002},{2.62181803e-002,5.92495593e-001,1.59127671e+000},{4.63963540e-001,1.23413025e+000,2.05869217e-002},{2.00132610e+001,2.60516254e-001,6.99559329e-001},{2.16596094e-001,1.21236852e+001,5.60865838e-001},{4.48867451e-001,8.66366718e+000,1.78503463e-001},{3.70062619e+000,2.14097897e-001,9.99096638e+000},{2.87477555e+000,1.82076844e-001,7.49165526e+000},{2.30342810e+000,1.56954150e-001,5.85782891e+000},{1.68655688e-001,2.97849774e+000,6.84240646e-002},{1.36979796e-001,2.43940729e+000,5.27258749e-002},{1.03591321e-001,3.22845199e+001,1.67791374e+000},{1.32531318e+000,2.10056032e+001,9.11853450e-002},{8.17512708e-002,1.11141388e+000,1.80840759e+001},{9.55524906e-001,1.62221677e+001,7.33140839e-002},{1.48901841e+001,8.38543079e-001,6.57432678e-002},{6.00177061e-002,1.53772451e+000,6.62418319e-001},{6.71583145e-001,1.26825395e+001,5.32334467e-002},{1.16783425e+001,6.09116446e-001,4.81610627e-002},{1.09392410e+001,4.37446816e-002,5.56286483e-001},{3.98684596e-002,1.04078166e+001,5.10869330e-001},{3.85345989e-002,3.98427790e-001,9.01419843e-001},{3.67019041e-001,8.66419596e-001,3.35778823e-002},{3.27807224e-001,7.43139061e-001,3.09411369e-002},{6.89943350e+000,3.64667232e-001,2.69888650e-002},{3.31800852e-001,5.85490274e+000,2.33777569e-002},{3.00006024e-001,4.92471215e+000,2.12308108e-002},{2.71719918e-001,4.19482500e+000,1.99325718e-002},{1.98965610e-002,3.61094513e+000,2.45583672e-001},{2.53082574e+000,1.88577417e-002,2.10753969e-001},{2.01624958e-001,2.53027803e+001,1.53610568e-002},{1.93131925e-001,1.63310938e+000,1.66083821e-002},{1.55143296e-002,1.76175995e-001,1.54330682e+000}};

/*Parameters for absorption scattering factors from Weickenmeier and Kohl*/
const double WK_V[41] = {0,0,0.5,0.5,0.3,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.4,0.5,0.5,0.5,0.5,0.5,0.2,0.3,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.2,0.3,0.5,0.5};
const double WK_B[41][6] = {{0,0,0,0,0,0},{0,0,0,0,0,0},{2.542e+00,8.743e+00,1.269e+01,4.371e-01,5.294e+00,2.825e+01},{6.845e-01,3.065e+00,6.240e+00,1.262e+02,1.312e+02,1.318e+02},{5.400e-01,3.388e+00,5.562e+01,5.078e+01,6.701e+01,9.637e+01},{3.314e-01,2.975e+00,3.401e+01,3.598e+01,3.668e+01,6.081e+01},{2.946e-01,3.934e+00,2.498e+01,2.528e+01,2.547e+01,4.670e+01},{2.393e-01,4.935e+00,1.812e+01,1.570e+01,1.582e+01,4.024e+01},{6.376e+00,8.037e+00,2.721e+01,1.116e-01,3.869e-0,1.090e+01},{2.180e-01,6.770e+00,7.051e+00,6.675e+00,1.238e+01,2.808e+01},{2.006e-01,5.498e+00,6.281e+00,7.192e+00,2.326e+01},{2.190e-01,5.300e+00,5.319e+00,5.283e+00,5.285e+00,1.282e+02},{1.973e+00,2.809e+00,1.639e+01,5.494e-02,2.061e+00,1.217e+02},{2.297e+00,2.358e+00,2.499e+01,7.462e-02,5.595e-01,1.285e+02},{1.727e+00,3.043e+00,3.057e+01,5.070e-02,9.918e-01,8.618e+01},{1.795e-01,2.632e+00,2.676e+00,3.457e+01,3.678e+01,5.406e+01},{1.006e+00,4.904e+00,3.135e+01,3.699e-02,9.870e-01,4.494e+01},{1.846e-01,1.480e+00,5.210e+00,2.479e+01,3.206e+01,3.910e+01},{2.006e-01,6.533e+00,2.272e+01,1.200e+00,1.274e+00,3.626e+01},{4.442e-01,3.367e+00,1.963e+01,1.824e-02,2.351e+01,2.129e+02},{1.827e-01,2.066e+00,1.699e+01,1.158e+01,1.398e+01,1.861e+02},{1.425e-01,1.466e+00,1.547e+01,4.243e+00,9.804e+00,1.215e+02},{1.278e-01,1.456e+00,1.210e+01,4.617e+00,1.197e+01,1.050e+02},{1.313e-01,1.399e+00,8.008e+00,7.981e+00,1.341e+01,9.531e+01},{1.231e-01,2.384e+00,9.921e+00,1.648e+00,1.100e+01,6.846e+01},{4.817e-01,3.783e+00,8.473e+00,4.690e-02,8.745e+00,7.744e+01},{4.470e-01,6.894e+00,6.903e+00,5.691e-02,3.026e+00,7.087e+01},{1.071e-01,3.636e+00,7.558e+00,1.280e+00,5.140e+00,6.716e+01},{1.107e-01,1.619e+00,6.003e+00,5.975e+00,6.060e+00,5.941e+01},{1.129e-01,1.891e+00,5.085e+00,5.073e+00,5.099e+00,4.639e+01},{1.021e-01,1.734e+00,4.783e+00,4.807e+00,5.645e+00,5.122e+01},{1.064e-01,1.537e+00,5.138e+00,4.743e+00,5.000e+00,6.143e+01},{9.583e-02,1.677e+00,4.703e+00,2.912e+00,7.870e+00,6.494e+01},{9.428e-02,2.214e+00,3.951e+00,1.521e+00,1.581e+01,5.241e+01},{9.252e-02,1.602e+00,3.049e+00,3.185e+00,1.894e+01,4.763e+01},{9.246e-02,1.773e+00,3.481e+00,1.884e+00,2.269e+01,4.069e+01},{4.932e-01,2.083e+00,1.141e+01,3.333e-02,2.097e+00,4.238e+01},{1.580e-01,1.715e+00,9.392e+00,1.675e+00,2.359e+01,1.525e+02},{3.605e-01,2.128e+00,1.246e+01,1.526e-02,2.108e+00,1.332e+02},{9.003e-02,1.414e+00,2.053e+00,1.026e+01,1.075e+01,9.064e+01},{1.009e-01,1.154e+00,2.347e+00,1.058e+01,1.095e+01,8.282e+01}};

const std::string elts[41] = {"None","H", "He", "Li", "Be", "B", "C", "N", "O", "F", "Ne", "Na", "Mg", "Al", "Si", "P", "S", "Cl", "Ar", "K", "Ca", "Sc", "Ti", "V", "Cr", "Mn", "Fe", "Co", "Ni", "Cu", "Zn", "Ga", "Ge", "As", "Se", "Br", "Kr", "Rb", "Sr", "Y", "Zr"};
